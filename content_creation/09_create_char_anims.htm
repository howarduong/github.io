<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
  <title>Create Character Movement Animations</title>
  <link rel="stylesheet" type="text/css" href="style.css">
  <meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
</head>
<body>
<!-- SCRIPT TO TOGGLE HEADING'S VISIBILITY -->
<SCRIPT>
function toggle_heading() {
 if (window.event.srcElement.tagName == "H2" || window.event.srcElement.tagName == "H3" || window.event.srcElement.tagName == "H4" || window.event.srcElement.tagName == "H5" || window.event.srcElement.tagName == "H6") { varObj=window.event.srcElement.parentElement.nextSibling; }
 else { varObj=window.event.srcElement.parentElement.parentElement.nextSibling; }
 if      (window.event.srcElement.tagName == "IMG") { varObjImg=window.event.srcElement; }
 else if (window.event.srcElement.tagName == "A")   { varObjImg=window.event.srcElement.previousSibling; }
 else                                               { varObjImg=window.event.srcElement.firstChild; }
 for ( ; varObj.tagName != "DIV" && varObj.tagName != "H1" && varObj.tagName != "H2" && varObj.tagName != "H3" && varObj.tagName != "H4" && varObj.tagName != "H5"; varObj=varObj.nextSibling) {}
  if (varObj.tagName == "DIV") { 
   if (varObj.style.display == "none") { varObj.style.display="block"; varObjImg.src="images/expanded.bmp";   }
   else                                { varObj.style.display="none";  varObjImg.src="images/expandable.bmp"; } } }
</script>

<!-- CHAPTER - CREATE CHARACTER MOVEMENT ANIMATIONS -->
<h1><a name="lessonTitle">Create Character Movement Animations</a></h1>
<DIV CLASS="TopOfPageTOC">
<SCRIPT>
function toggle() {
 var numOfChildren=window.event.srcElement.parentElement.childNodes.length;
 for (var varIdx=0 ; varIdx < numOfChildren && window.event.srcElement.parentElement.childNodes[varIdx].tagName != "UL" ; varIdx++) {}
 if (varIdx <= numOfChildren) {
  if (window.event.srcElement.parentElement.childNodes[varIdx].style.display == "none") {
   window.event.srcElement.src="images/expanded.bmp";
   window.event.srcElement.parentElement.childNodes[varIdx].style.display="inline"; }
  else {
   window.event.srcElement.src="images/expandable.bmp";
   window.event.srcElement.parentElement.childNodes[varIdx].style.display="none"; } } }
</SCRIPT>
<UL>
<LI><IMG SRC="images/leaf.bmp"><A HREF="09_create_char_anims.htm#Root_Node_Translate">Translation of the root node for animations</A></LI>
<LI><IMG SRC="images/leaf.bmp"><A HREF="09_create_char_anims.htm#Using">Linear movement of the root node</A></LI>
<LI><IMG SRC="images/expandable.bmp" ONCLICK=toggle()><A HREF="09_create_char_anims.htm#Synchronising">Synchronising blend transitions </A></LI>
 <UL STYLE="display:none">
 <LI><IMG SRC="images/leaf.bmp"><A HREF="09_create_char_anims.htm#Start_position">Starting position</A></LI>
 <LI><IMG SRC="images/leaf.bmp"><A HREF="09_create_char_anims.htm#Locomotion">Locomotion animations</A></LI>
 <LI><IMG SRC="images/leaf.bmp"><A HREF="09_create_char_anims.htm#Turn_Animations">Turn Animation</A></LI>
</UL>
<LI><IMG SRC="images/leaf.bmp"><A HREF="09_create_char_anims.htm#Falling">Falling animations</A></LI>
<LI><IMG SRC="images/leaf.bmp"><A HREF="09_create_char_anims.htm#Death_Animations">Death animations </A></LI>
<LI><IMG SRC="images/leaf.bmp"><A HREF="09_create_char_anims.htm#FrameRate">Animation frame rate</A></LI>
<LI><IMG SRC="images/leaf.bmp"><A HREF="09_create_char_anims.htm#Maya_Animation">Animation range</A></LI>
<LI><IMG SRC="images/expandable.bmp" ONCLICK=toggle()><A HREF="09_create_char_anims.htm#Exporting">Exporting character animation with BigWorld Exporter</A></LI>
 <UL STYLE="display:none">
 <LI><IMG SRC="images/leaf.bmp"><A HREF="09_create_char_anims.htm#3DSMaxExportAnim">Exporting animation from 3ds Max for use in the BigWorld engine</A></LI>
 <LI><IMG SRC="images/leaf.bmp"><A HREF="09_create_char_anims.htm#MAYAExportAnim">Exporting animation from Maya for use in the BigWorld engine</A></LI>
 </UL>
<LI><IMG SRC="images/leaf.bmp"><A HREF="09_create_char_anims.htm#OppositeFacing">Opposite Facing Direction</A></LI>
<LI><IMG SRC="images/expandable.bmp" ONCLICK=toggle()><A HREF="09_create_char_anims.htm#RigDesignCustomisable">Designing rigs for customisable models </A></LI>
 <UL STYLE="display:none">
 <LI><IMG SRC="images/leaf.bmp"><A HREF="09_create_char_anims.htm#SuperModel">Supermodel </A></LI>
 <LI><IMG SRC="images/leaf.bmp"><A HREF="09_create_char_anims.htm#RevHardPoints">Driving Hard Point attached items with the parent models action matcher </A></LI>
 <LI><IMG SRC="images/leaf.bmp"><A HREF="09_create_char_anims.htm#VertexNormal">Fixing vertex normal seams </A></LI>
 </UL> 
<LI><IMG SRC="images/expandable.bmp" ONCLICK=toggle()><A HREF="09_create_char_anims.htm#ReferenceHierarchy">Reference hierarchy/custom node hierarchy</A></LI>
 <UL STYLE="display:none">
 <LI><IMG SRC="images/leaf.bmp"><A HREF="09_create_char_anims.htm#Unwanted_Controllers">Using the Reference Hierarchy feature to remove unwanted controllers  </A></LI>
 <LI><IMG SRC="images/leaf.bmp"><A HREF="09_create_char_anims.htm#HP_hierarchy">Animating HP using a reference hierarchy </A></LI>
 </UL>
<LI><IMG SRC="images/leaf.bmp"><A HREF="09_create_char_anims.htm#NoteTracks">Adding note tracks to trigger events and sounds</A></LI>
</UL>
<HR>
</DIV> <!-- END TopOfPageTOC -->

<p>Characters to be used in the BigWorld engine should be modelled and
animated facing the BACK view. So, if you look at your model from the
front viewport your
character will be facing away from you. This applies for both 3ds Max and
Maya.</p>
<p> It is very important that you create your characters like this. It will save significant time,
and minimise problems when it comes to incorporating   animation into the game.</p>
<p>Trying to rotate or scale a model/rig after it has been skinned and animated 
in the wrong direction is usually problematic. Correct setup is highly recommended.</p>
<p class=imgLvl1><img src="09_create_char_anims_files/image048.png">
                 <img src="09_create_char_anims_files/image049.png">
                 <img src="09_create_char_anims_files/image050.png"></p>
<p class=captLvl1>Characters modelled facing the back view in Maya, 3ds Max and in FantasyDemo</p>

<p>If your modelers have problems modelling characters facing away from the
front viewport, simply reverse the mapping of your front and back viewport 
keys.</p>
<p>If you have pre existing assets that are rigged to face towards the front view you can use them within the BigWorld engine by using the <a href="#OppositeFacing">Opposite Facing</a> feature of the exporter </p>
<span onclick=toggle_heading()><h2><img src="images/expanded.bmp"><a name="Root_Node_Translate">Animations must translate the root node</a></h2></span>
<DIV>

<p>The translation of the root node in 3ds Max and Maya is used to determine the playback speed of an animation as it translates in the game so as to prevent foot sliding.  Without movement translation the Action Matcher will not be able to <a href="11_create_actions.htm#ScalePlayBack">scale the playback speed</a> of the animation to prevent foot sliding. </p>

<p><b>Characters must move when animating</b></p>

<p class=imgLvl1><img src="09_create_char_anims_files/moving.gif" height=158></p>
<p class=captLvl1>Bipeds and other rigs must move off the origin for exporting &ndash; Do NOT animate in place. Do not animate foot sliding. </p>

<p><b>Do not animate on the spot</b></p>

<p class=imgLvl1><img src="09_create_char_anims_files/onspot.gif" height=162></p>
<p class=captLvl1>If the root node does not move, then the character will not move in the BigWorld engine.</p>

</DIV>
<span onclick=toggle_heading()><h2><img src="images/expanded.bmp"><a name="Using">Linear movement of the root node</a></h2></span>
<DIV>

<p> In the BigWorld engine, objects derive their speed from the translation of
  the object's root node. Due to optimisations on the BigWorld server it
  is important that the root node moves at a linear rate for each
  animation. If non linear translations are used, discrepancies between the position of the client model and server entity will cause animation glitches or even game play problems (e.g. targeting discrepancies). </p>
<p>Take the following example. </p>
<p><img src="09_create_char_anims_files/image51.gif" width="356" height="122"></p>
<p class="captLvl1">Linear forward movement of the root node ensures model position matches entity position</p>
<p><img src="09_create_char_anims_files/image52.gif" width="356" height="122"></p>
<p class="captLvl1">When the root node's forward movement is not linear discrepancies between avatar and entity position occur.</p>
<p>This means that an object such as a biped can only have two keys for its 
  horizontal movement: a start key frame, and an end key frame. Any number of keys 
  is allowed for non-translational keys. For example, the root node may move side 
  to side, and up and down.</p>

<p class="imgLvl1"><img src="09_create_char_anims_files/image018.png"></p>
<p class="captLvl1">Permissible biped centre movement &ndash; only vertical and horizontal sideways</p>

<p>To ensure that a 3ds Max biped is moving with linear movement, delete all
the horizontal keys in between the first and last key.</p>

<p>Select and delete the middle <b>Horizontal</b> body 
movement keys, leaving the start and end keys remaining.</p>

<p class="imgLvl1"><img src="09_create_char_anims_files/image034.png"></p>
<p class="captLvl1">Middle horizontal keys are deleted leaving only a single beginning and end key. </p>

<table class="noteLvl1"><tbody><tr><td><br></td><td>
<p>This will make the biped's forward movement linear from start to finish, 
so that the avatar's perceived position mimics the position of the avatar on the server. </p>
<p>The only variable movement allowed for the biped centre between the 
start and finish is either vertical (Z-axis) 'bobbing' movement, or 
sideways horizontal (X-axis) movement for pelvic weight shifting.</p>
</td></tr></tbody></table>

<p>The same rules apply to non-biped rigs. The root node must have a linear
rate of movement from its beginning position to its end position.</p>

<p class=imgLvl1><img src="09_create_char_anims_files/image036.png"></p>
<p class=captLvl1>This type of movement for the root node is NOT allowed. The character will
clip through the ground,<br>and its position indicated by the model will
not match that of the position of the entity on the server.</p>

<p class=imgLvl1><img src="09_create_char_anims_files/image035.png"></p>
<p class=captLvl1>This movement is allowed for the root node. The position of the model matches 
that of the entity on the server.</p>

<p>The same goes for animations in Maya. A character's root node must move 
linearly along the direction of intended travel.</p>

<p class=imgLvl1><img src="09_create_char_anims_files/image042.png"></p>

<p>Just remember that the centre node must translate with linear tangents 
between two keys at the start and finish.</p>
</DIV>
<span onclick=toggle_heading()>
<h2><span onClick="toggle_heading()"><img src="images/expanded.bmp"><a name="Synchronising" id="Synchronising">Synchronising blend transitions </a></span></h2>
</span>
<DIV>
  <h3><span onClick="toggle_heading()"><img src="images/expanded.bmp"><a name="Start_position" id="Start_position">Starting position </a></span></h3>
  <DIV>
    <p>Its always best to ensure that the root node of the model is centered to the world coordinates (X=0 Y=0 in 3dsMax and X=0 Z=0 in Maya) for the first frame of most animations. This makes the task of synchronising animation blends simpler. </p>
    <p>&nbsp;</p>
  </DIV>
  <h3><span onClick="toggle_heading()"><img src="images/expanded.bmp"><a name="Locomotion" id="Locomotion">Locomotion animations </a></span></h3>
  <DIV>
    <p>When an <a href="11_create_actions.htm">action</a> tagged as <a href="11_create_actions.htm#TagsAndTracks">IsMovement</a> blends into another IsMovement tagged action the BigWorld engine will synchronise the point at which the two animations blend. </p>
    <p>Example 1. In the image below demonstrates a 30 frame walk animation (Blue) transitioning into a 30 frame run animation (Red). The walk animation just happens to complete its entire cycle before the run animation is blended in. Such an example would have perfect blending providing the position of the feet match during both walk and run cycles.</p>
    <p>Example 2.  This transition occurs as the walk animations is half way through its cycle (frame 15). The BigWorld engine cleverly blends in the new run animation at half way through its cycle (frame 16) to maintain perfect blending. </p>
    <p>Example 3. Even when the run animation is half the number of frames as the walk animation, the BigWorld engine maintains perfect blending by finding the half way point of the run animation (15/2 = ~8) and uses this point to blend.</p>
    <p>&nbsp;</p>
    <p><img src="09_create_char_anims_files/image007.jpg" width="380" height="353"></p>
    <p>The conclusion to all the above examples is that the animator only needs to follow one simple rule  when creating an animations. </p>
    <p><strong>Ensure that each animation is a single cycle of movement, and all animation cycles that need to blend with one another should start and end at the same pose.</strong></p>
    <p>So if frame 1 of the walk animation starts with left foot forward, then frame 1 of the run animation should also start with left foot forward. </p>
    <p><img src="09_create_char_anims_files/image006.jpg" width="430" height="181"></p>
    <p class=captLvl1>How to position the  first frame of Idle, Walk, Jog, Run to ensure a nice blending between actions. </p>
  </DIV>
  <h3><span onClick="toggle_heading()"><img src="images/expanded.bmp"><a name="Turn_Animations" id="Turn_Animations">Turn Animations </a></span></h3>
  <DIV>
    <p><br>
    When creating Turn_left and Turn_right animations it is best to get the initial pose from the first frame of the idle animation and duplicate it. That first frame of the Idle animation should be the first frame of the turn animation. </p>
    <p>The last frame of the turn animation should also be the same frame as the first frame of the Idle animation with the  root node turned 90 degrees. There should be no forward or backward translation of the models root node. </p>
    <p>Model position:<br>
Its always best to ensure that the root node of the model is centered to the world coordinates in X=0 Y=0 in 3dsMax and X=0 Z=0 in Maya. </p>
    <p class=numBltLvl1></p>
  </DIV>
</DIV>
<span onclick=toggle_heading()>
<h2><img src="images/expanded.bmp"><a name="Falling">Falling animations</a></h2>
</span>
<DIV>

<p>When creating falling animations, do not translate the root node of your 
character in your modelling package. The model should remain in place and flail 
its arms around as if falling. The avatar model will be translated by code in-game.
The corresponding  action for a falling model should use the <a href="11_create_actions.htm">model is falling</a> tag.</p>
</DIV>
<span onclick=toggle_heading()><h2><img src="images/expanded.bmp"><a name="Death_Animations">Death animations </a></h2></span>
<DIV>

<p>Death animations are usually broken up into at least two sections: the death 
animation playing in its entirety, and a repeat of the last frame of the death 
animation. </p>
<p>Create a single animation of the character's death in your 3d package, then 
in ModelEditor import the animation twice into the 
<a href="10_add_anims_to_chars.htm">animation tab</a>. Name  the second import 
something identifiable such as <code>death:endframe</code>.</p>

<p class=imgLvl1><img src="09_create_char_anims_files/image001.gif"></p>

<p>The first animation should be set to play in its entirety.</p>
<p>The second animation should be set to play only the last frame of the animation.</p>

<p class=imgLvl1><img src="09_create_char_anims_files/image002.gif"></p>
<p class=imgLvl1><img src="09_create_char_anims_files/image001.jpg"></p>

<p>Create two death <a href="11_create_actions.htm">actions</a>, one for the 
entire animation and one for the repeated last frame. </p>

</DIV>
<span onclick=toggle_heading()><h2><img src="images/expanded.bmp"><a name="FrameRate" id="FrameRate">Animation frame rate</a></h2></span>
<DIV>

<p>We suggest using a frame rate of 30 frames per second or higher for 
animations to be used in the BigWorld engine.</p>
<p>Using a frame rate lower than 30fps does not give a visually appealing
result. Remember, animations are automatically compressed by the BigWorld 
engine, so you are better off creating your animations at a higher frame rate 
and then adjusting the compression in ModelEditor.</p>
<p>To set frame rate in 3ds Max, open the <b>Time Configuration</b> dialog box
via the <img src="09_create_char_anims_files/image039.png"> button.</p>

<p class="imgBltLvl1"><img src="images/bullet.gif">In the <b>Frame Rate</b> 
group box, select the <b>Custom</b> option button.</p>
<p class="imgBltLvl1"><img src="images/bullet.gif">Set the <b>FPS</b> field 
to <code>30</code>.</p></td></tr></tbody></table>

<p class=imgLvl2><img src="09_create_char_anims_files/image004.png">

<p>To set frame rate in Maya, open the <b>Animation Preferences</b> dialog box
via the <img src="09_create_char_anims_files/image041.png"> button.

<p>Set the <b>Playback Speed</b> to <b>Other</b>, and enter <b>30</b> in the 
<b>Other Speed</b> dialog box.</p>

<p class=imgLvl1><img src="09_create_char_anims_files/image040.png"></p>

</DIV>
<span onclick=toggle_heading()><h2><img src="images/expanded.bmp"><a name="Maya_Animation">Animation range</a></h2></span>
<DIV>

<p>In 3ds Max the range of animation exported is defined by setting the 
<b>Start Time</b> and <b>End Time</b> within the <b>Time Configuration</b> 
dialog box.</p>

<p>For example, if you wanted to export only the animation between keys 75 and 
105, you would set the following in the <b>Animation</b> group box:</p>

<p class="imgBltLvl1"><img src="images/bullet.gif">Set <b>Start Time</b> to 
<b>75</b>.</p>  
<p class="imgBltLvl1"><img src="images/bullet.gif">Set <b>End Time</b> to 
<b>105</b>.</p>

<p class=imgLvl2><img src="09_create_char_anims_files/image010.gif"></p>

<p>In Maya, the exporter will read from the <b>Playback Start Time</b> to the 
<b>Playback End Time</b>.</p>

<p>Any animation keys outside these extents will not be exported.</p>

<p class="imgLvl1"><img src="09_create_char_anims_files/image033.png"></p>
<p class="captLvl1">Only information stored from frames 1 to 10 will be exported</p>

</DIV>
<span onclick=toggle_heading()><h2><img src="images/expanded.bmp"><a name="Exporting">Exporting character animation with BigWorld Exporter</a></h2></span>
<DIV>

<span onclick=toggle_heading()><h3><img src="images/expanded.bmp"><a name="3DSMaxExportAnim" id="3DSMaxExportAnim">Exporting animation from 3ds Max for use in the BigWorld engine</a></h3></span>
<DIV>

<p class=numBltLvl1>1  Select the <b>File&rarr;Export</b> menu item.</p>

<p class=imgLvl2><img src="09_create_char_anims_files/image043.png"></p>

<p class=numBltLvl1>2 In the dialog box that appears, select the <b>Animation 
Exporter (*.ANIMATION)</b> entry in the <b>Save As Type</b> drop-down list box
&ndash; this will select BigWorld's proprietary 3ds Max plug-in.</p>

<p class=numBltLvl1>3 Enter the name of the animation in the <b>File Name</b> 
field.</p></p>

<p class=imgLvl2><img src="09_create_char_anims_files/image026.png"></p>

<p class=numBltLvl1>4 Click the <b>Save</b> button &ndash; this will open the 
<b>Animation Exporter</b> dialog box.</p>

<p class="imgLvl4"><img src="09_create_char_anims_files/image027.png"></p>

<p class="lvl2">The following check boxes are available:</p>
<p class="imgBltLvl2"><img src="images/bullet.gif"><b>Allow Scale</b>: 
determines whether mesh scale animations should be exported along with the 
animation. If you do not scale a mesh in your animation, then do NOT select this
option.</p>
<p class="imgBltLvl2"><img src="images/bullet.gif"><b>Export morph animation</b>:
determines whether 3ds Max morph target and Maya blend shape animations should
be exported. See the Morph Target and Blend Shape section for further 
information.</p>
<p class="imgBltLvl2"><img src="images/bullet.gif"><b>Export node animation</b>: 
determines whether skeletal node animations should be exported.</p>
<p class="imgBltLvl2"><img src="images/bullet.gif"><b>Use reference hierarchy</b>:
determines whether another hierarchy should be used to animate the character 
&ndash; <a href="#ReferenceHierarchy">see below for explanation.</a></p>

<p class=lvl2>For a character animation such as a walk cycle:</p>
<p class="imgBltLvl2"><img src="images/bullet.gif">Make sure that only the 
<b>Export Node Animation</b> check box is selected.</p>
<p class="imgBltLvl2"><img src="images/bullet.gif">Click <b>OK</b>.</p>

<p>There will now be a <code>walk.animation</code> file located in the resource
structure to which you exported the animation.</p>

</DIV>
<span onclick=toggle_heading()><h3><img src="images/expanded.bmp"><a name="MAYAExportAnim" id="MAYAExportAnim">Exporting animation from Maya for use in the BigWorld engine</a></h3></span>
<DIV>

<p class=numBltLvl1>1 Select the <b>File&rarr;Export All</b> menu item.</p>

<p class=imgLvl2><img src="09_create_char_anims_files/image044.png"></p>

<p class=numBltLvl1>2 In the <b>File Type Specific Options</b> group box's 
<b>Export Type</b> group box, select the <b>Animation</b> option button, then 
click the <b>Export All</b> button.</p>

<p class=imgLvl2><img src="09_create_char_anims_files/image046.png"></p>

<p class=numBltLvl1>3 Specify the location in which to save your 
<code>*.animation</code> file, then click the <b>Save</b> button.</p>

</DIV>
</DIV>
<span onclick=toggle_heading()>
<h2><span onClick="toggle_heading()"><img src="images/expanded.bmp"><a name="OppositeFacing" id="OppositeFacing">Opposite Facing Direction </a></span></h2>
</span>
<DIV>
  <p>Characters and NPCs should be modelled so that they are facing away from the front
  viewport. If a character has been rigged with the incorrect BigWorld setup 
  (i.e.. facing forward) it can be fixed using the Opposite Facing Direction 
  option within the exporter. </p>
  <p>Let's suppose we have a character that has been rigged  facing the front viewport
  (the incorrect way). Simply rotating this character will result in what appears to be 
  a fix. However, when this character is implemented into the game the rotation of the
  root node will cause irregularities with its animations. </p>
  <p>To correctly fix an character facing the wrong way:</p>
  <p class=numBltLvl1>1 Export the <code>.visual</code> using the advanced option <b>Opposite Facing Direction</b>;</p>
  <p class=numBltLvl1>2 Export the <code>.animation</code> using the advanced option <b>Opposite Facing Direction</b>;</p>
  <p class=imgLvl1><img src="09_create_char_anims_files/image003.gif" width="302" height="236"></p>
  <p class=imgLvl1>&nbsp;</p>
  <p class=imgLvl1>The model should now face the correct direction within BigWorld and its animation data will also move in the correct direction.</p>
</DIV>
<span onclick=toggle_heading()>
<h2><span onClick="toggle_heading()"><img src="images/expanded.bmp"><a name="RigDesignCustomisable" id="RigDesignCustomisable">Designing Rigs for customisable models</a></span></h2>
</span>
<DIV>
  <p>Many games require highly customisable player and NPC models. This section deals with some of the possible techniques you can use to customise your model. </p>
  <h3><span onClick="toggle_heading()"><img src="images/expanded.bmp"><a name="SuperModel" id="SuperModel">Supermodel</a></span></h3>
  <DIV>
    <p class=imgLvl1>A supermodel is a model made up of several separate  model files that are all rigged to the same skeleton. A good example of this is the Female Warrior character in the Fantasy Demo. Each piece of the warrior's armour is rigged to the same skeleton that the warrior's base mesh is rigged to. The BigWorld engine simply loads both models and deforms them with the same skeleton. The image below shows the large number of separate models that can go together to make the final supermodel. </p>
    <p class=imgLvl1>&nbsp;</p>
    <p class=imgLvl1>For character customisation purposes supermodel pieces are best used if the piece to be attached is meant to  deform with the characters animation. If the piece being attached is static or animates in an unrelated/unsynchronised manner to the characters animation then a <a href="#RevHardPoints">Hard Point</a> attachment should probably be used.</p>
    <p class=imgLvl1><img src="09_create_char_anims_files/image010.jpg" width="621" height="538"></p>
    <p class=imgLvl1>&nbsp;</p>
    <p class=imgLvl1>When creating a Super Model in your 3d application simply skin multiple objects into the same skeleton and export each one individually. </p>
    <p class=imgLvl1>Parts of a supermodel can be viewed together in Model Editor by using <em>File - Add Model</em> or <em>Ctrl + drag</em> from Asset Browser. Note this is only for preview purposes. </p>
  </DIV>
  <h3><span onClick="toggle_heading()"><img src="images/expanded.bmp"><a name="RevHardPoints" id="RevHardPoints">Driving Hard Point attached items with the parent models Action Matcher </a></span></h3>
  <DIV>
    <p class=imgLvl1> Although <a href="08_create_lowpoly_char.htm#PlacingHPsOnCharacter">Hard Points</a> usually have static objects attached to them, it can sometimes  be desirable to attach fully animating objects to the player model via Hard Points. </p>
    <p class=imgLvl1>&nbsp;</p>
    <p class=imgLvl1>Items attached via Hard Points can have their actions automated &quot;revved&quot; via the parent models <a href="11_create_actions.htm">action matcher</a>. Put simply, you can attach a model via a Hard Point  and have its actions driven by the parent models action matcher. </p>
    <p class=imgLvl1>&nbsp;</p>
    <p class=imgLvl1>The types of animating models best attached via Hard Points are those who's animations do not have to be synchronised with the base models animations. </p>
    <p class=imgLvl1>For example, a pinwheel stuck in the players hat would be very suitable for an action matcher driven Hard Point attached item. Clothing, A cape, or ponytail need to be synchronised with the base models animations and would  be best done using supermodel.</p>
    <p class=imgLvl1>&nbsp;</p>
    <p class=imgLvl1>Several changes have to be made to the python code in order to enable action matcher driven attached objects. If you want to use this feature ensure that a programmer has made these changes. </p>
    <p class=imgLvl1>1. Add an action matcher motor to the attached model (e.g. the staff), and set 
      its useEntityModel property to True.<br>
    2. Set $p.model.moveAttachments to True</p>
    <p class=imgLvl1>To see this work in Fantasy Demo (the FD scripts currently aren't setting this<br>
    up automatically), take out the staff and enter these commands into the Python:</p>
    <p class=imgLvl1><strong>am = BigWorld.ActionMatcher( $p )<br>
      am.useEntityModel = True<br>
      $p.model.right_hand.addMotor( am )<br>
      $p.model.moveAttachments = True<br>
    $B.debugAQ( $p.model.right_hand )</strong></p>
    <p class=imgLvl1>You should then see the actions being triggered on the staff as you move the
      character around.</p>
    <p class=imgLvl1>&nbsp;</p>
    <p class=imgLvl1>Note: That if you need to scale the playback speed of a movement animation then the animation of the HardPoint attached item will also require translation in its animation. Please see the<code> staff.model</code> animation <code>staff_item_locomotion_world_transform.animation </code>as an example. </p>
    <p class=imgLvl1>The staff.model used by the player character in FantasyDemo has its actions driven by the player model. </p>
    <p class=imgLvl1>To view the actions on the staff model type the following into the python console (~tilde +P) </p>
    <p class=imgLvl1>$B.debugAQ($p.model.right_hand)</p>
    <p class=imgLvl1>&nbsp;</p>
    <p class=imgLvl1>Note that the staff model actions react to the players movement. </p>
    <p class=imgLvl1>&nbsp;</p>
    <p class=imgLvl1><img src="09_create_char_anims_files/image009.jpg" width="516" height="215"></p>
    <p class=imgLvl1>&nbsp;</p>
    <p class=imgLvl1>&nbsp;</p>
	
	
  </DIV>
  <h3><img src="images/expanded.bmp"><a name="VertexNormal" id="VertexNormal">Fixing vertex normal seams </a></h3>
  <DIV>
    <p class=imgLvl1>When creating a supermodel it is common to want two separate meshes to share a common boundary. When meshes are cut into separate pieces they each get their own new vertex normal which unfortunately does not match the vertex normal of the neighbouring mesh. The result is a lighting seam which can be seen in the image below along with the two newly made vertex normals</p>
    <p class=imgLvl1><img src="09_create_char_anims_files/image011.jpg" width="201" height="280"></p>
	<p class="captLvl1">Lighting seam resulting from split mesh</p>
    <p class=imgLvl1>Fortunately these normals can be consolidated using the Edit Normals modifier in 3dsMax or the Vertex Normal Edit tool (Lock Normals) in Maya</p>
    <p class=imgLvl1><img src="09_create_char_anims_files/image012.jpg" width="1236" height="443"></p>
    <p class="captLvl1">Vertex normals being consolidated using the Edit Normals Modifier</p>
	<p class=imgLvl1><strong>For 3dsMax: </strong></p>
	<p class=imgLvl1>Note: Editing a models vertex normals <strong>only works when the model is skinned. </strong></p>
	<p class=imgLvl1>1. Select both assets you wish to consolidate vertex normals</p>
	<p class=imgLvl1>2. Give them a shared <em><strong>Edit Normals</strong> </em>modifier</p>
    <p class=imgLvl1>3. Select by <em><strong>Normals</strong> </em></p>
    <p class=imgLvl1>4. Average the <em><strong>Selected</strong></em> normals </p>
    <p class=imgLvl1>5. Make modifier <strong>unique</strong></p>
    <p class=imgLvl1>6. Ensure that each part of the model is exported separately using <strong>export selected</strong> and  the model is exported with <em><strong>Normal mapped</strong> </em>selected</p>
    <p class=imgLvl1><img src="09_create_char_anims_files/image013.jpg" width="284" height="221"></p>
    <p class=imgLvl1>&nbsp;</p>
    <p class=imgLvl1>For Maya:</p>
    <p class=imgLvl1>1. Lock Normals neighbouring normals using the  <strong>Normals &gt; Vertex Normal Edit Tool </strong></p>
    <p class=imgLvl1>2.  Ensure that each part of the model is exported separately using <strong>export selected</strong> and  the model is exported with <em><strong>Normal mapped</strong> </em>selected</p>
    <p class=imgLvl1>&nbsp;</p>
  </DIV>
</DIV>
<span onclick=toggle_heading()><h2><img src="images/expanded.bmp"><a name="ReferenceHierarchy">Reference hierarchy/custom node hierarchy</a></h2>
</span>
<DIV>

<p>The Reference Hierarchy option allows animators to animate a model using a different hierarchical setup to the default setup exported with the model. </p>
<p>For example if you decided for a specific animation it would be  easier to animate the character if the root node was the hand (hanging from a tree) rather than the default root node being in the hips, then you could use the Reference Hierarchy option. Sound strange?, well this is exactly what occurs when you create an IK target for a limb. The hierarchy becomes reversed and the limb rotations are solved by the IK controller. In such a case the reference hierarchy solution is essential. </p>
<p>To use the reference hierarchy option:</p>
<p class=numBltLvl1>1 The default hierarchy (hip as root) visual should be exported without any modifications to the hierarchy. This visual will be used as the reference hierarchy. </p>
<p class=numBltLvl1>2 The 3d file should be saved as a separate backup file.</p>
<p class=numBltLvl1>3 The 3d file is altered so that a new hierarchy exists (hand as root). </p>
<p class=numBltLvl1>4 The model is animated with the new hierarchy (hand as root).</p>
<p class=numBltLvl1>5 Export the animation selecting the Use reference hierarchy option. When you select the option it will bring up a dialog asking for the location of the reference hierarchy. Simply select the original visual exported in point 1. </p>
<p class=imgLvl1><img src="09_create_char_anims_files/image028.png"></p>
<DIV>
  <h3><span onClick="toggle_heading()"><img src="images/expanded.bmp"><a name="Unwanted_Controllers" id="Unwanted_Controllers">Using the Reference Hierarchy feature to remove unwanted controllers </a></span></h3>
  <DIV>
    <p class=imgLvl1>The aim of this example is to export animations to<em> BigWorld</em> without exporting unnecessary objects like animation handles &amp; controllers which may get exported along with the rest of the skeleton. In order to achieve this, we will need to export a<em> .visual </em>file without the controller objects, this will be our reference hierarchy visual. </p>
    <p class=imgLvl1>&nbsp;</p>
    <p class=imgLvl1><img src="09_create_char_anims_files/image003.jpg" width="300" height="326"></p>
    <ul><li>The example scene contains dummy /controller objects which we do not want exported when we save out a <em>.visual</em> file. </li>
      <li>Save the original rig and in a new copy delete the controller objects within the scene that should not be included in the exporting process.</li>
    </ul>
    <p><img src="09_create_char_anims_files/image004.jpg" width="317" height="328"></p>
    <ul>
      <li>Save out this basic scene with just the skeleton and blendshape as a different scene. </li>
      <li>Export this model  <strong><em>File/Export All - </em></strong> <strong><em>Bigworld Asset</em></strong>  as a <em>.visual animated,skinned.</em> This is our reference hierarchy model. </li>
      <li>Open up the previous scene with the controller objects and go to <strong><em>File/Export All</em></strong> options and this time, export the scene as &quot;<strong><em>Animation</em></strong>&quot;. Be sure to check &quot;<strong><em>Use Reference Node</em></strong>&quot;.</li>
      <li>A new window will pop up asking you to select the clean base scene. Browse for the <em>.visual</em> file you saved out previously and click &quot; <em><strong>OK&quot;</strong></em>. </li>
      <li>Load up Model Editor and load in the <em>.visual</em> and <em>.animation</em> files that you exported. if you have followed the proper steps, you should end up with a clean animated scene, without the controller objects.</li>
    </ul>
    </DIV>
</DIV>
<p class=imgLvl1></p>
<DIV>
  <h3><span onClick="toggle_heading()"><img src="images/expanded.bmp"><a name="HP_hierarchy" id="HP_hierarchy">Animating HP using a reference hierarchy</a></span></h3>
  <DIV>
    <p><br>
      In a conventional rig the Hard Points of the characters hands will be children of the Hand Node. </p>
    <p>This works perfectly and is easy to animate providing those hard points remain in exactly the same place relative to the hand (i.e. they don't move).</p>
    <p>Problems arise if you want to  animate those hard points, for example if the player throws his weapon into the air and then catches it. It becomes very difficult to animate the hard point whilst it is attached to the players hand node.</p>
    <p>In such a case you may want to detach the hard point and animate the HP directly (or attach it to another object like the weapon and animate that object). </p>
    <p>If a rig hierarchy is modified as above for an animation purpose, and it differs from the default rig exported with the primitive file. then  the &quot;use reference hierarchy&quot; feature must be used. </p>
    <p>&nbsp;</p>
    <p>In the case where a HP is detached from the hand and then attached to a weapon the following should be performed. </p>
    <p>1. Export the model, visual, and primitive file with the conventional rig (HP attached to hand)</p>
    <p>2. Export all conventional animations (HP attached to hand) as normal</p>
    <p>3. Export all non conventional animations (HP detached from hand) using the &quot;use reference hierarchy&quot; feature. When prompted for a reference visual refer to the conventional <em>.visual</em> file exported with 1. </p>
    </DIV>
</DIV>
</DIV>

<!-------- HORIZONTAL RULE --------><span onclick=toggle_heading()>
<h2><img src="images/expanded.bmp"><a name="NoteTracks" id="NoteTracks">Adding Note tracks to trigger events and sounds </a></h2>
</span>
<DIV>
  <p>Note tracks are only supported from 3dsMax. If you use Maya please refer to the section on <a href="16_animating_char_interactions.htm#Exporting">splitting up actions</a></p>
  <p>Note tracks are a way of inserting information at specific times into animation so events like sounds and special effects can be triggered. </p>
  <p>In order to add a note track, select the node you wish to add the track to in the 3d viewport.</p>
  <p> Open the <strong>Graph Editors - Dope Sheet</strong></p>
  <p><span class="imgLvl1"><img src="09_create_char_anims_files/image004.gif" width="189" height="112"></span> </p>
  <p>The node you selected in the 3d Viewport should be visible.</p>
  <p>It is essential that note tracks be added directly to a node. Note tracks added to the global scene or deep with a nodes parameters (such as its transforms or materials) will be ignored. </p>
  <p><img src="09_create_char_anims_files/image007.gif" width="251" height="213"></p>
  <p> Once the node is selected chose <strong>Tracks - Note Track - Add </strong></p>
  <p><span class="imgLvl1"><img src="09_create_char_anims_files/image005.gif" width="302" height="129"></span></p>
  <p>Edit the notes parameters by right clicking on the note on the dope sheet. </p>
  <p>BigWorld will recognise the following inputs</p>
  <p><strong>cue:name</strong></p>
  <p><strong>sound:name</strong></p>
  <p>Replace <strong>name</strong> with the event you wish to trigger. It is essential that no spaces or carriage return  be entered after the note </p>
  <p>For example, sound:ui/boop will trigger the sound event named "ui/boop".</p>
  <p><img src="09_create_char_anims_files/image006.gif" width="477" height="350"></p>
  <p>When you export your animation  tick the box &quot;Export cue track&quot; </p>
  <p><img src="09_create_char_anims_files/image008.gif" width="192" height="204"></p>
  <p>These notes will trigger a callback which a programmer can use to set up special effects. </p>
</DIV>
<hr align="center" size="2" width="100%">
<p class="copyrightInfo">Copyright 1999-2011 BigWorld Pty. Ltd. All rights reserved. Proprietary commercial in confidence.</p>
<!-------- END OF DOCUMENT -------->
</body></html>
